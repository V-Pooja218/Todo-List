import java.io.*;
import java.util.*;

// -------- INTERFACE --------
interface Payable {
    double calculateSalary();
}

// -------- ABSTRACT CLASS --------
abstract class Employee implements Payable {
    protected int empId;
    protected String name;
    protected double performanceRating;

    public Employee(int empId, String name, double rating) {
        this.empId = empId;
        this.name = name;
        this.performanceRating = rating;
    }

    public int getEmpId() { return empId; }
    public String getName() { return name; }
    public double getRating() { return performanceRating; }

    public abstract String getType();

    public String toFileString() {
        return getType() + "," + empId + "," + name + "," + performanceRating;
    }
}

// -------- FULL TIME --------
class FullTimeEmployee extends Employee {
    private double monthlySalary;

    public FullTimeEmployee(int id, String name, double rating, double salary) {
        super(id, name, rating);
        this.monthlySalary = salary;
    }

    public double calculateSalary() {
        return monthlySalary + (performanceRating * 1000);
    }

    public String getType() { return "FULLTIME"; }

    @Override
    public String toFileString() {
        return super.toFileString() + "," + monthlySalary;
    }
}

// -------- PART TIME --------
class PartTimeEmployee extends Employee {
    private int hoursWorked;
    private double hourlyRate;

    public PartTimeEmployee(int id, String name, double rating,
                            int hours, double rate) {
        super(id, name, rating);
        this.hoursWorked = hours;
        this.hourlyRate = rate;
    }

    public double calculateSalary() {
        return (hoursWorked * hourlyRate) + (performanceRating * 500);
    }

    public String getType() { return "PARTTIME"; }

    @Override
    public String toFileString() {
        return super.toFileString() + "," + hoursWorked + "," + hourlyRate;
    }
}

// -------- MAIN SYSTEM --------
public class EmployeeSystem {

    static HashMap<Integer, Employee> employees = new HashMap<>();
    static final String FILE_NAME = "employees.txt";

    public static void saveToFile() {
        try (PrintWriter pw = new PrintWriter(new FileWriter(FILE_NAME))) {
            for (Employee e : employees.values()) {
                pw.println(e.toFileString());
            }
        } catch (IOException e) {
            System.out.println("Error saving file.");
        }
    }

    public static void loadFromFile() {
        try (BufferedReader br = new BufferedReader(new FileReader(FILE_NAME))) {
            String line;
            while ((line = br.readLine()) != null) {
                String[] data = line.split(",");
                if (data[0].equals("FULLTIME")) {
                    employees.put(
                        Integer.parseInt(data[1]),
                        new FullTimeEmployee(
                            Integer.parseInt(data[1]),
                            data[2],
                            Double.parseDouble(data[3]),
                            Double.parseDouble(data[4])
                        )
                    );
                } else {
                    employees.put(
                        Integer.parseInt(data[1]),
                        new PartTimeEmployee(
                            Integer.parseInt(data[1]),
                            data[2],
                            Double.parseDouble(data[3]),
                            Integer.parseInt(data[4]),
                            Double.parseDouble(data[5])
                        )
                    );
                }
            }
        } catch (IOException e) {
            System.out.println("No previous records found.");
        }
    }

    public static void addEmployee(Scanner sc) {
        try {
            System.out.print("Enter ID: ");
            int id = sc.nextInt();
            sc.nextLine();
            System.out.print("Enter Name: ");
            String name = sc.nextLine();
            System.out.print("Enter Rating (1-5): ");
            double rating = sc.nextDouble();

            System.out.println("1. Full Time");
            System.out.println("2. Part Time");
            int type = sc.nextInt();

            if (type == 1) {
                System.out.print("Enter Monthly Salary: ");
                double salary = sc.nextDouble();
                employees.put(id,
                        new FullTimeEmployee(id, name, rating, salary));
            } else {
                System.out.print("Enter Hours Worked: ");
                int hours = sc.nextInt();
                System.out.print("Enter Hourly Rate: ");
                double rate = sc.nextDouble();
                employees.put(id,
                        new PartTimeEmployee(id, name, rating, hours, rate));
            }

            System.out.println("Employee added successfully!");

        } catch (Exception e) {
            System.out.println("Invalid Input!");
            sc.nextLine();
        }
    }

    public static void viewEmployees() {
        if (employees.isEmpty()) {
            System.out.println("No employees found.");
            return;
        }

        for (Employee e : employees.values()) {
            System.out.println("ID: " + e.getEmpId());
            System.out.println("Name: " + e.getName());
            System.out.println("Type: " + e.getType());
            System.out.println("Salary: " + e.calculateSalary());
            System.out.println("---------------------");
        }
    }

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        loadFromFile();
        int choice;

        do {
            System.out.println("\n===== EMPLOYEE MANAGEMENT SYSTEM =====");
            System.out.println("1. Add Employee");
            System.out.println("2. View Employees");
            System.out.println("3. Save & Exit");
            System.out.print("Enter choice: ");

            choice = sc.nextInt();

            switch (choice) {
                case 1:
                    addEmployee(sc);
                    break;
                case 2:
                    viewEmployees();
                    break;
                case 3:
                    saveToFile();
                    System.out.println("Data saved. Exiting...");
                    break;
                default:
                    System.out.println("Invalid choice!");
            }

        } while (choice != 3);

        sc.close();
    }
}
